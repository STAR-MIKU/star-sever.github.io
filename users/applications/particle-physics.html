<!DOCTYPE html>
<html>
<head>
  <title>粒子物理模拟实验室</title>
  <style>
    body { 
      margin: 0; 
      overflow: hidden; 
      background: #111;
    }
    canvas { 
      display: block; 
    }
    .controls {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 8px;
      color: white;
      font-family: Arial, sans-serif;
      backdrop-filter: blur(5px);
    }
    .control-group {
      margin-bottom: 10px;
    }
    label {
      display: block;
      font-size: 12px;
      margin-bottom: 5px;
    }
    input[type="range"] {
      width: 100%;
    }
    button {
      background: #4CAF50;
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 5px;
      font-size: 12px;
    }
    .info {
      position: fixed;
      bottom: 20px;
      left: 20px;
      color: white;
      font-family: Arial, sans-serif;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <canvas id="particleCanvas"></canvas>
  <div class="controls">
    <div class="control-group">
      <label>重力: <span id="gravityValue">0.5</span></label>
      <input type="range" id="gravity" min="0" max="2" step="0.1" value="0.5">
    </div>
    <div class="control-group">
      <label>摩擦系数: <span id="frictionValue">0.98</span></label>
      <input type="range" id="friction" min="0.9" max="0.999" step="0.001" value="0.98">
    </div>
    <div class="control-group">
      <label>粒子大小: <span id="sizeValue">5</span></label>
      <input type="range" id="size" min="1" max="20" value="5">
    </div>
    <div class="control-group">
      <label>粒子数量: <span id="countValue">100</span></label>
      <input type="range" id="count" min="10" max="500" value="100">
    </div>
    <div>
      <button id="addParticles">添加粒子</button>
      <button id="clear">清空</button>
      <button id="toggleGravity">反转重力</button>
    </div>
  </div>
  <div class="info">
    交互: 点击添加粒子 | 拖拽创建引力场 | 滚轮缩放粒子大小
  </div>

  <script>
    const canvas = document.getElementById('particleCanvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    let gravity = 0.5;
    let friction = 0.98;
    let particleSize = 5;
    let particleCount = 100;
    let gravityInverted = false;
    let attractor = null; // 引力源 {x, y, strength}

    // 设置画布尺寸
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // 粒子类
    class Particle {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.size = particleSize;
        this.vx = (Math.random() - 0.5) * 5;
        this.vy = (Math.random() - 0.5) * 5;
        this.color = `hsl(${Math.random() * 360}, 70%, 60%)`;
        this.mass = this.size * 0.1;
      }

      update() {
        // 应用引力
        this.vy += gravity * this.mass;
        
        // 应用引力源
        if (attractor) {
          const dx = attractor.x - this.x;
          const dy = attractor.y - this.y;
          const distance = Math.sqrt(dx * dx + dy * dy);
          if (distance > 0 && distance < 200) {
            const force = (attractor.strength / (distance * distance)) * this.mass;
            this.vx += (dx / distance) * force;
            this.vy += (dy / distance) * force;
          }
        }
        
        // 应用摩擦
        this.vx *= friction;
        this.vy *= friction;
        
        // 更新位置
        this.x += this.vx;
        this.y += this.vy;
        
        // 边界碰撞
        if (this.x - this.size < 0) {
          this.x = this.size;
          this.vx = -this.vx * 0.8; // 能量损失
        } else if (this.x + this.size > canvas.width) {
          this.x = canvas.width - this.size;
          this.vx = -this.vx * 0.8;
        }
        
        if (this.y - this.size < 0) {
          this.y = this.size;
          this.vy = -this.vy * 0.8;
        } else if (this.y + this.size > canvas.height) {
          this.y = canvas.height - this.size;
          this.vy = -this.vy * 0.8;
        }
      }

      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();
        // 绘制粒子速度尾迹
        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x - this.vx * 3, this.y - this.vy * 3);
        ctx.strokeStyle = this.color;
        ctx.lineWidth = this.size * 0.5;
        ctx.stroke();
      }
    }

    // 添加粒子
    function addParticles(count = particleCount, x = canvas.width / 2, y = canvas.height / 2) {
      for (let i = 0; i < count; i++) {
        particles.push(new Particle(
          x + (Math.random() - 0.5) * 50,
          y + (Math.random() - 0.5) * 50
        ));
      }
    }

    // 初始化粒子
    addParticles();

    // 动画循环
    function animate() {
      requestAnimationFrame(animate);
      ctx.fillStyle = 'rgba(17, 17, 17, 0.1)'; // 拖影效果
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // 更新并绘制所有粒子
      for (let i = 0; i < particles.length; i++) {
        particles[i].update();
        particles[i].draw();
      }
    }
    animate();

    // 事件监听 - 点击添加粒子
    canvas.addEventListener('click', (e) => {
      addParticles(particleCount / 5, e.clientX, e.clientY);
    });

    // 事件监听 - 拖拽创建引力场
    canvas.addEventListener('mousedown', (e) => {
      attractor = {
        x: e.clientX,
        y: e.clientY,
        strength: 200
      };
    });

    canvas.addEventListener('mousemove', (e) => {
      if (attractor) {
        attractor.x = e.clientX;
        attractor.y = e.clientY;
      }
    });

    window.addEventListener('mouseup', () => {
      attractor = null;
    });

    // 事件监听 - 滚轮缩放粒子大小
    canvas.addEventListener('wheel', (e) => {
      e.preventDefault();
      particleSize += e.deltaY > 0 ? -0.5 : 0.5;
      particleSize = Math.max(1, Math.min(20, particleSize));
      document.getElementById('size').value = particleSize;
      document.getElementById('sizeValue').textContent = particleSize.toFixed(1);
      
      // 更新现有粒子大小
      particles.forEach(p => p.size = particleSize);
    });

    // 控制按钮事件
    document.getElementById('addParticles').addEventListener('click', () => {
      addParticles();
    });

    document.getElementById('clear').addEventListener('click', () => {
      particles = [];
    });

    document.getElementById('toggleGravity').addEventListener('click', () => {
      gravityInverted = !gravityInverted;
      gravity = gravityInverted ? -0.5 : 0.5;
      document.getElementById('gravity').value = Math.abs(gravity);
      document.getElementById('gravityValue').textContent = Math.abs(gravity).toFixed(1);
    });

    // 滑块控制
    document.getElementById('gravity').addEventListener('input', (e) => {
      gravity = parseFloat(e.target.value) * (gravityInverted ? -1 : 1);
      document.getElementById('gravityValue').textContent = e.target.value;
    });

    document.getElementById('friction').addEventListener('input', (e) => {
      friction = parseFloat(e.target.value);
      document.getElementById('frictionValue').textContent = e.target.value;
    });

    document.getElementById('size').addEventListener('input', (e) => {
      particleSize = parseInt(e.target.value);
      document.getElementById('sizeValue').textContent = e.target.value;
      particles.forEach(p => p.size = particleSize);
    });

    document.getElementById('count').addEventListener('input', (e) => {
      particleCount = parseInt(e.target.value);
      document.getElementById('countValue').textContent = e.target.value;
    });
  </script>
</body>
</html>
    